# ğŸš€ Recipe-Genius Cloudflare Workers éƒ¨ç½²å®Œæˆ

Recipe-Geniusæ™ºèƒ½èœè°±ç”Ÿæˆå™¨å·²æˆåŠŸé…ç½®ä¸ºä½¿ç”¨OpenNext + Cloudflare Workersè¿›è¡Œéƒ¨ç½²ã€‚

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. ğŸ› ï¸ é¡¹ç›®é…ç½®
- âœ… å®‰è£…äº†OpenNextå’ŒCloudflare Workersä¾èµ–
- âœ… åˆ›å»ºäº†`open-next.config.ts`é…ç½®æ–‡ä»¶
- âœ… æ›´æ–°äº†`next.config.js`ä»¥æ”¯æŒCloudflare Workers
- âœ… é…ç½®äº†TypeScriptç±»å‹å®šä¹‰

### 2. ğŸ”§ Cloudflare Workersç¯å¢ƒ
- âœ… åˆ›å»ºäº†`wrangler.toml`é…ç½®æ–‡ä»¶
- âœ… é…ç½®äº†å¤šç¯å¢ƒæ”¯æŒï¼ˆdevelopment, staging, productionï¼‰
- âœ… è®¾ç½®äº†KVå­˜å‚¨ã€ç¯å¢ƒå˜é‡å’Œèµ„æºé™åˆ¶
- âœ… æ·»åŠ äº†å®‰å…¨å¤´éƒ¨å’ŒCORSé…ç½®

### 3. ğŸ”Œ APIè·¯ç”±å…¼å®¹æ€§
- âœ… åˆ›å»ºäº†Cloudflare Workerså…¼å®¹çš„å·¥å…·å‡½æ•°
- âœ… ä¿®æ”¹äº†AIæä¾›å•†é…ç½®ä»¥æ”¯æŒåŠ¨æ€ç¯å¢ƒå˜é‡
- âœ… æ·»åŠ äº†APIåŒ…è£…å™¨ä»¥å¤„ç†é”™è¯¯å’Œæ€§èƒ½ç›‘æ§
- âœ… åˆ›å»ºäº†å¥åº·æ£€æŸ¥ç«¯ç‚¹

### 4. ğŸ” ç¯å¢ƒå˜é‡ç®¡ç†
- âœ… åˆ›å»ºäº†è‡ªåŠ¨åŒ–ç¯å¢ƒå˜é‡è®¾ç½®è„šæœ¬
- âœ… é…ç½®äº†å®‰å…¨çš„APIå¯†é’¥å­˜å‚¨
- âœ… æ”¯æŒå‰ç«¯localStorageä¸æœåŠ¡ç«¯ç¯å¢ƒå˜é‡çš„å…¼å®¹
- âœ… æ·»åŠ äº†ç¯å¢ƒå˜é‡æ¨¡æ¿æ–‡ä»¶

### 5. ğŸ“¦ æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
- âœ… æ›´æ–°äº†package.jsonè„šæœ¬
- âœ… åˆ›å»ºäº†è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- âœ… æ·»åŠ äº†éƒ¨ç½²å‰æ£€æŸ¥å’ŒéªŒè¯
- âœ… é…ç½®äº†å¤šç¯å¢ƒéƒ¨ç½²æ”¯æŒ

### 6. âš¡ æ€§èƒ½ä¼˜åŒ–
- âœ… å®ç°äº†æ™ºèƒ½ç¼“å­˜ç®¡ç†
- âœ… æ·»åŠ äº†å†·å¯åŠ¨ä¼˜åŒ–
- âœ… é…ç½®äº†å“åº”å‹ç¼©
- âœ… å®ç°äº†æ€§èƒ½ç›‘æ§

### 7. ğŸ§ª æµ‹è¯•å’ŒéªŒè¯
- âœ… åˆ›å»ºäº†è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
- âœ… ä¿®å¤äº†æ‰€æœ‰TypeScriptç±»å‹é”™è¯¯
- âœ… éªŒè¯äº†æ„å»ºè¿‡ç¨‹
- âœ… æ·»åŠ äº†éƒ¨ç½²åéªŒè¯

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æŒ‡å—

### å‰ç½®è¦æ±‚
```bash
# å®‰è£…Wrangler CLI
npm install -g wrangler

# ç™»å½•Cloudflare
wrangler login
```

### ä¸€é”®éƒ¨ç½²
```bash
# 1. è®¾ç½®ç¯å¢ƒå˜é‡å’ŒAPIå¯†é’¥
npm run cf:setup

# 2. æ„å»ºé¡¹ç›®
npm run build:cloudflare

# 3. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
npm run deploy

# 4. éªŒè¯éƒ¨ç½²
./scripts/test-deployment.sh production
```

### åˆ†æ­¥éƒ¨ç½²
```bash
# å¼€å‘ç¯å¢ƒ
npm run cf:setup:dev
npm run deploy:dev

# é¢„å‘å¸ƒç¯å¢ƒ
npm run cf:setup:staging
npm run deploy:staging

# ç”Ÿäº§ç¯å¢ƒ
npm run cf:setup:production
npm run deploy:production
```

## ğŸ“‹ é…ç½®æ¸…å•

### å¿…éœ€é…ç½®
- [ ] æ›´æ–°`wrangler.toml`ä¸­çš„åŸŸåé…ç½®
- [ ] è®¾ç½®è‡³å°‘ä¸€ä¸ªAIæä¾›å•†çš„APIå¯†é’¥
- [ ] åˆ›å»ºKVå‘½åç©ºé—´å¹¶æ›´æ–°é…ç½®
- [ ] é…ç½®DNSè®¾ç½®ï¼ˆå¦‚ä½¿ç”¨è‡ªå®šä¹‰åŸŸåï¼‰

### æ¨èé…ç½®
- [ ] é…ç½®å¤šä¸ªAIæä¾›å•†ä½œä¸ºå¤‡ç”¨
- [ ] è®¾ç½®ç›‘æ§å’Œå‘Šè­¦
- [ ] é…ç½®CI/CDæµæ°´çº¿
- [ ] å¯ç”¨åˆ†æå’Œé”™è¯¯è¿½è¸ª

## ğŸ”‘ æ”¯æŒçš„AIæä¾›å•†

| æä¾›å•† | è·å–åœ°å€ | ç¯å¢ƒå˜é‡ | çŠ¶æ€ |
|--------|----------|----------|------|
| **DeepSeek** | [platform.deepseek.com](https://platform.deepseek.com) | `DEEPSEEK_API_KEY` | âœ… æ¨è |
| **è±†åŒ…** | [console.volcengine.com/ark](https://console.volcengine.com/ark) | `DOUBAO_API_KEY`, `DOUBAO_ENDPOINT_ID` | âœ… ç¨³å®š |
| **é€šä¹‰åƒé—®** | [dashscope.aliyuncs.com](https://dashscope.aliyuncs.com) | `QWEN_API_KEY` | âœ… å¯ç”¨ |
| **æ™ºè°±AI** | [open.bigmodel.cn](https://open.bigmodel.cn) | `GLM_API_KEY` | âœ… å¯ç”¨ |
| **Google Gemini** | [aistudio.google.com](https://aistudio.google.com/app/apikey) | `GOOGLE_API_KEY` | âœ… å¤‡ç”¨ |

## ğŸ“Š åŠŸèƒ½ç‰¹æ€§

### ğŸ”„ æ™ºèƒ½å›é€€æœºåˆ¶
- å‰ç«¯APIå¯†é’¥é…ç½®ä¼˜å…ˆ
- è‡ªåŠ¨å›é€€åˆ°ç¯å¢ƒå˜é‡
- å¤šæä¾›å•†æ•…éšœè½¬ç§»

### ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§
- APIå¯†é’¥åŠ å¯†å­˜å‚¨
- å®‰å…¨å¤´éƒ¨é…ç½®
- é€Ÿç‡é™åˆ¶ä¿æŠ¤
- CORSç­–ç•¥æ§åˆ¶

### âš¡ æ€§èƒ½ä¼˜åŒ–
- æ™ºèƒ½ç¼“å­˜ç­–ç•¥
- å†·å¯åŠ¨ä¼˜åŒ–
- å“åº”å‹ç¼©
- é™æ€èµ„æºä¼˜åŒ–

### ğŸ“ˆ ç›‘æ§å’Œè°ƒè¯•
- å®æ—¶æ—¥å¿—è®°å½•
- æ€§èƒ½æŒ‡æ ‡ç›‘æ§
- å¥åº·æ£€æŸ¥ç«¯ç‚¹
- é”™è¯¯è¿½è¸ª

## ğŸ› ï¸ æœ‰ç”¨çš„å‘½ä»¤

### å¼€å‘å’Œè°ƒè¯•
```bash
# æœ¬åœ°é¢„è§ˆ
wrangler dev

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
npm run cf:tail

# æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
npm run cf:deployments

# æŸ¥çœ‹ç¯å¢ƒå˜é‡
npm run cf:secrets
```

### ç®¡ç†å’Œç»´æŠ¤
```bash
# å›æ»šéƒ¨ç½²
wrangler rollback

# æ›´æ–°APIå¯†é’¥
wrangler secret put DEEPSEEK_API_KEY

# æ¸…ç†KVå­˜å‚¨
wrangler kv:key delete <key> --binding CACHE
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **æ„å»ºå¤±è´¥**: è¿è¡Œ`npm run build:check`æ£€æŸ¥ç±»å‹å’Œè¯­æ³•
2. **APIå¯†é’¥æ— æ•ˆ**: ä½¿ç”¨`npm run cf:secrets`æ£€æŸ¥é…ç½®
3. **éƒ¨ç½²å¤±è´¥**: æ£€æŸ¥`wrangler.toml`é…ç½®å’Œæƒé™
4. **åŠŸèƒ½å¼‚å¸¸**: æŸ¥çœ‹`npm run cf:tail`çš„å®æ—¶æ—¥å¿—

### è°ƒè¯•æŠ€å·§
- ä½¿ç”¨å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼š`/api/health`
- æŸ¥çœ‹APIçŠ¶æ€é¡µé¢ï¼š`/api-status`
- è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼š`./scripts/test-deployment.sh`

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è¯¦ç»†éƒ¨ç½²æŒ‡å—](./docs/CLOUDFLARE_DEPLOYMENT.md)
- [APIå¯†é’¥é…ç½®æŒ‡å—](./docs/API_KEY_CONFIGURATION.md)
- [Cloudflare Workersæ–‡æ¡£](https://developers.cloudflare.com/workers/)
- [OpenNextæ–‡æ¡£](https://opennext.js.org/)

## ğŸ‰ éƒ¨ç½²å®Œæˆï¼

Recipe-Geniusç°åœ¨å·²ç»å®Œå…¨é…ç½®ä¸ºä½¿ç”¨Cloudflare Workerséƒ¨ç½²ã€‚æ‚¨å¯ä»¥ï¼š

1. **ç«‹å³éƒ¨ç½²**: ä½¿ç”¨æä¾›çš„è„šæœ¬å¿«é€Ÿéƒ¨ç½²åˆ°Cloudflare
2. **é…ç½®APIå¯†é’¥**: é€šè¿‡å‰ç«¯ç•Œé¢æˆ–ç¯å¢ƒå˜é‡é…ç½®AIæä¾›å•†
3. **ç›‘æ§æ€§èƒ½**: ä½¿ç”¨å†…ç½®çš„ç›‘æ§å’Œæ—¥å¿—åŠŸèƒ½
4. **æ‰©å±•åŠŸèƒ½**: åŸºäºç°æœ‰æ¶æ„æ·»åŠ æ–°åŠŸèƒ½

äº«å—æ‚¨çš„é«˜æ€§èƒ½ã€å…¨çƒåˆ†å¸ƒçš„æ™ºèƒ½èœè°±ç”Ÿæˆå™¨ï¼ğŸ³âœ¨

---

**æŠ€æœ¯æ”¯æŒ**: å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æ£€æŸ¥ç›¸å…³æ–‡æ¡£ã€‚
