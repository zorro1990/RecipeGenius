"use strict";(()=>{var e={};e.id=170,e.ids=[170],e.modules={628:(e,r,t)=>{t.d(r,{Sk:()=>u,X7:()=>a,bD:()=>o,gx:()=>i,l3:()=>c});var n=t(6819),s=t(5697);async function i(e,r,t,i){try{let a=s.XV.replace("{ingredients}",e.join(", ")).replace("{preferences}",r.dietaryRestrictions.join(", ")).replace("{timeLimit}",r.cookingTime.toString()).replace("{servings}",r.servings.toString()).replace("{difficulty}",r.difficulty),o=await (0,s.jn)(a,t,i),c=(0,n.O)(o);if(!c)throw Error("无法从响应中提取有效的JSON");let u=(0,n.$l)(c,null);if(!u)throw Error("无法解析菜谱JSON数据");if(!u.title||!u.ingredients||!u.steps)throw Error("菜谱数据不完整，缺少必需字段");return{id:(0,n.$C)(),title:u.title,description:u.description||"",ingredients:Array.isArray(u.ingredients)?u.ingredients.map(e=>({name:e.name||"",quantity:e.quantity||"",unit:e.unit||""})):[],steps:Array.isArray(u.steps)?u.steps:[],cookingTime:"number"==typeof u.cookingTime?u.cookingTime:r.cookingTime,servings:"number"==typeof u.servings?u.servings:r.servings,difficulty:["easy","medium","hard"].includes(u.difficulty)?u.difficulty:r.difficulty,nutrition:u.nutrition?{calories:u.nutrition.calories||0,protein:u.nutrition.protein||0,carbs:u.nutrition.carbs||0,fat:u.nutrition.fat||0,fiber:u.nutrition.fiber||0}:{calories:0,protein:0,carbs:0,fat:0,fiber:0},tags:Array.isArray(u.tags)?u.tags:[],tips:Array.isArray(u.tips)?u.tips:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}catch(e){throw console.error("生成菜谱失败:",e),Error(`生成菜谱失败: ${e instanceof Error?e.message:"未知错误"}`)}}async function a(e){try{let r=s.hI.replace("{title}",e.title).replace("{ingredients}",e.ingredients.map(e=>`${e.name} ${e.quantity}${e.unit}`).join(", ")).replace("{servings}",e.servings.toString()),t=await (0,s.callAI)(r),i=(0,n.O)(t);if(!i)throw Error("无法从响应中提取营养信息JSON");let a=(0,n.$l)(i,null);if(!a)throw Error("无法解析营养信息JSON数据");return{calories:a.calories||0,protein:a.protein||0,carbs:a.carbs||0,fat:a.fat||0,fiber:a.fiber||0}}catch(e){throw console.error("营养分析失败:",e),Error(`营养分析失败: ${e instanceof Error?e.message:"未知错误"}`)}}async function o(e,r=3,t=1e3){for(let n=0;n<r;n++)try{return await e()}catch(e){if(n===r-1)throw e;await new Promise(e=>setTimeout(e,t*(n+1)))}throw Error("Max retries exceeded")}async function c(){try{let e=(0,s.In)();if(0===e.length)return{success:!1,provider:"none",message:"没有配置任何AI提供商",error:"请在环境变量中配置至少一个API密钥"};return await (0,s.callAI)('请回复"连接成功"'),{success:!0,provider:e[0].name,message:`AI连接成功，使用提供商: ${e[0].name}`}}catch(e){return{success:!1,provider:"unknown",message:"AI连接失败",error:e instanceof Error?e.message:"未知错误"}}}function u(){let e=(0,s.In)(),r=e.filter(e=>"doubao"!==e.name);return{available:e.map(e=>e.name),configured:e.length,recommended:e.length>0?e[0].name:"none",recipeProviders:r.map(e=>e.name)}}},846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3629:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>x,routeModule:()=>f,serverHooks:()=>h,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>y});var n={};t.r(n),t.d(n,{DELETE:()=>g,GET:()=>p,POST:()=>l,PUT:()=>d});var s=t(6559),i=t(8088),a=t(7719),o=t(2190),c=t(628),u=t(6819);async function l(e){try{let{ingredients:r,preferences:t,apiKeys:n,preferredProvider:s}=await e.json();if(!r||!Array.isArray(r)||0===r.length)return o.NextResponse.json({success:!1,error:"请至少提供一种食材"},{status:400});if(!t)return o.NextResponse.json({success:!1,error:"请提供用户偏好设置"},{status:400});let i=(0,u.iX)(r);if(0===i.length)return o.NextResponse.json({success:!1,error:"请提供有效的食材名称"},{status:400});let a={dietaryRestrictions:t.dietaryRestrictions||[],cuisineType:t.cuisineType||[],cookingTime:Math.max(10,Math.min(120,t.cookingTime||30)),servings:Math.max(1,Math.min(8,t.servings||2)),difficulty:["easy","medium","hard"].includes(t.difficulty)?t.difficulty:"easy",allergies:t.allergies||[]},l=await (0,c.bD)(()=>(0,c.gx)(i,a,n,s),3,2e3);return o.NextResponse.json({success:!0,data:{recipe:l},message:"菜谱生成成功"})}catch(t){console.error("菜谱生成API错误:",t);let e="菜谱生成失败，请稍后重试",r=500;return t instanceof Error&&(t.message.includes("API key")?(e="AI服务配置错误，请联系管理员",r=503):t.message.includes("quota")||t.message.includes("limit")?(e="AI服务暂时不可用，请稍后重试",r=503):t.message.includes("timeout")?(e="请求超时，请重试",r=408):e=(0,u.NR)(t)),o.NextResponse.json({success:!1,error:e},{status:r})}}async function p(){return o.NextResponse.json({success:!1,error:"不支持的请求方法"},{status:405})}async function d(){return o.NextResponse.json({success:!1,error:"不支持的请求方法"},{status:405})}async function g(){return o.NextResponse.json({success:!1,error:"不支持的请求方法"},{status:405})}let f=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/generate-recipe/route",pathname:"/api/generate-recipe",filename:"route",bundlePath:"app/api/generate-recipe/route"},resolvedPagePath:"/Users/zorro/Documents/augment-projects/cooker/recipe-genius/app/api/generate-recipe/route.ts",nextConfigOutput:"standalone",userland:n}),{workAsyncStorage:m,workUnitAsyncStorage:y,serverHooks:h}=f;function x(){return(0,a.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:y})}},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6819:(e,r,t)=>{function n(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function s(e){return e.map(e=>e.trim()).filter(e=>e.trim().length>0&&e.trim().length<=50).filter((e,r,t)=>t.indexOf(e)===r)}function i(e){return e instanceof Error?e.message:"string"==typeof e?e:"发生了未知错误"}function a(e){let r=e.match(/\{[\s\S]*\}/);return r?r[0]:null}function o(e,r=null){try{return JSON.parse(e)}catch{return r}}t.d(r,{$C:()=>n,$l:()=>o,NR:()=>i,O:()=>a,iX:()=>s})},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[447,580,117],()=>t(3629));module.exports=n})();