"use strict";(()=>{var e={};e.id=1,e.ids=[1],e.modules={628:(e,r,t)=>{t.d(r,{Sk:()=>u,X7:()=>o,bD:()=>a,gx:()=>i,l3:()=>c});var n=t(6819),s=t(5697);async function i(e,r,t,i){try{let o=s.XV.replace("{ingredients}",e.join(", ")).replace("{preferences}",r.dietaryRestrictions.join(", ")).replace("{timeLimit}",r.cookingTime.toString()).replace("{servings}",r.servings.toString()).replace("{difficulty}",r.difficulty),a=await (0,s.jn)(o,t,i),c=(0,n.O)(a);if(!c)throw Error("无法从响应中提取有效的JSON");let u=(0,n.$l)(c,null);if(!u)throw Error("无法解析菜谱JSON数据");if(!u.title||!u.ingredients||!u.steps)throw Error("菜谱数据不完整，缺少必需字段");return{id:(0,n.$C)(),title:u.title,description:u.description||"",ingredients:Array.isArray(u.ingredients)?u.ingredients.map(e=>({name:e.name||"",quantity:e.quantity||"",unit:e.unit||""})):[],steps:Array.isArray(u.steps)?u.steps:[],cookingTime:"number"==typeof u.cookingTime?u.cookingTime:r.cookingTime,servings:"number"==typeof u.servings?u.servings:r.servings,difficulty:["easy","medium","hard"].includes(u.difficulty)?u.difficulty:r.difficulty,nutrition:u.nutrition?{calories:u.nutrition.calories||0,protein:u.nutrition.protein||0,carbs:u.nutrition.carbs||0,fat:u.nutrition.fat||0,fiber:u.nutrition.fiber||0}:{calories:0,protein:0,carbs:0,fat:0,fiber:0},tags:Array.isArray(u.tags)?u.tags:[],tips:Array.isArray(u.tips)?u.tips:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}catch(e){throw console.error("生成菜谱失败:",e),Error(`生成菜谱失败: ${e instanceof Error?e.message:"未知错误"}`)}}async function o(e){try{let r=s.hI.replace("{title}",e.title).replace("{ingredients}",e.ingredients.map(e=>`${e.name} ${e.quantity}${e.unit}`).join(", ")).replace("{servings}",e.servings.toString()),t=await (0,s.callAI)(r),i=(0,n.O)(t);if(!i)throw Error("无法从响应中提取营养信息JSON");let o=(0,n.$l)(i,null);if(!o)throw Error("无法解析营养信息JSON数据");return{calories:o.calories||0,protein:o.protein||0,carbs:o.carbs||0,fat:o.fat||0,fiber:o.fiber||0}}catch(e){throw console.error("营养分析失败:",e),Error(`营养分析失败: ${e instanceof Error?e.message:"未知错误"}`)}}async function a(e,r=3,t=1e3){for(let n=0;n<r;n++)try{return await e()}catch(e){if(n===r-1)throw e;await new Promise(e=>setTimeout(e,t*(n+1)))}throw Error("Max retries exceeded")}async function c(){try{let e=(0,s.In)();if(0===e.length)return{success:!1,provider:"none",message:"没有配置任何AI提供商",error:"请在环境变量中配置至少一个API密钥"};return await (0,s.callAI)('请回复"连接成功"'),{success:!0,provider:e[0].name,message:`AI连接成功，使用提供商: ${e[0].name}`}}catch(e){return{success:!1,provider:"unknown",message:"AI连接失败",error:e instanceof Error?e.message:"未知错误"}}}function u(){let e=(0,s.In)(),r=e.filter(e=>"doubao"!==e.name);return{available:e.map(e=>e.name),configured:e.length,recommended:e.length>0?e[0].name:"none",recipeProviders:r.map(e=>e.name)}}},846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6615:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>m,routeModule:()=>l,serverHooks:()=>g,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>f});var n={};t.r(n),t.d(n,{GET:()=>u,POST:()=>p});var s=t(6559),i=t(8088),o=t(7719),a=t(2190),c=t(628);async function u(){try{let e=(0,c.Sk)(),r=await (0,c.l3)(),t={doubao:!!process.env.DOUBAO_API_KEY,deepseek:!!process.env.DEEPSEEK_API_KEY,qwen:!!process.env.QWEN_API_KEY,glm:!!process.env.GLM_API_KEY,gemini:!!process.env.GOOGLE_API_KEY},n={};try{n={note:"前端API密钥状态需要通过客户端JavaScript获取",available:"请使用新的API设置界面管理前端密钥"}}catch(e){n={error:"无法获取前端API密钥状态"}}let s=[];return 0===e.configured?(s.push("\uD83D\uDD11 请配置至少一个AI提供商的API密钥"),s.push("\uD83D\uDCA1 推荐使用新的前端API设置界面（点击首页右上角设置图标）"),s.push("\uD83D\uDCCB 推荐配置顺序：DeepSeek > 豆包 > 通义千问 > 智谱AI > Gemini")):1===e.configured&&(s.push("✅ 建议配置多个AI提供商作为备用"),s.push("\uD83D\uDD27 可以使用前端API设置界面管理多个提供商")),t.doubao||s.push("\uD83C\uDFAF 豆包API访问稳定，可在前端设置或配置 DOUBAO_API_KEY"),t.deepseek||s.push("\uD83D\uDE80 DeepSeek价格最低，可在前端设置或配置 DEEPSEEK_API_KEY"),s.push(""),s.push("\uD83C\uDD95 新功能：现在支持前端API密钥配置！"),s.push("   • 点击首页右上角的设置图标"),s.push("   • 安全的本地加密存储"),s.push("   • 实时API密钥验证"),s.push("   • 支持多提供商管理"),a.NextResponse.json({success:r.success,message:r.message,data:{connection:r,providers:e,environment:t,frontend:n,suggestions:s,info:{version:"2.0",features:["前端API密钥配置","多提供商支持","实时验证","安全存储","智能回退"],usage:"访问首页右上角设置图标配置API密钥"}}})}catch(e){return console.error("AI测试错误:",e),a.NextResponse.json({success:!1,error:"AI测试失败",details:e instanceof Error?e.message:"未知错误"},{status:500})}}async function p(e){try{let{prompt:r}=await e.json();if(!r)return a.NextResponse.json({success:!1,error:"请提供测试提示词"},{status:400});let{callAI:n}=await Promise.resolve().then(t.bind(t,5697)),s=await n(r);return a.NextResponse.json({success:!0,message:"AI调用成功",data:{prompt:r,response:s,provider:(0,c.Sk)().recommended}})}catch(e){return console.error("AI调用测试错误:",e),a.NextResponse.json({success:!1,error:"AI调用失败",details:e instanceof Error?e.message:"未知错误"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/test-ai/route",pathname:"/api/test-ai",filename:"route",bundlePath:"app/api/test-ai/route"},resolvedPagePath:"/Users/zorro/Documents/augment-projects/cooker/recipe-genius/app/api/test-ai/route.ts",nextConfigOutput:"standalone",userland:n}),{workAsyncStorage:d,workUnitAsyncStorage:f,serverHooks:g}=l;function m(){return(0,o.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:f})}},6819:(e,r,t)=>{function n(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function s(e){return e.map(e=>e.trim()).filter(e=>e.trim().length>0&&e.trim().length<=50).filter((e,r,t)=>t.indexOf(e)===r)}function i(e){return e instanceof Error?e.message:"string"==typeof e?e:"发生了未知错误"}function o(e){let r=e.match(/\{[\s\S]*\}/);return r?r[0]:null}function a(e,r=null){try{return JSON.parse(e)}catch{return r}}t.d(r,{$C:()=>n,$l:()=>a,NR:()=>i,O:()=>o,iX:()=>s})},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[447,580,117],()=>t(6615));module.exports=n})();