"use strict";(()=>{var e={};e.id=772,e.ids=[772],e.modules={846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9982:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>k,routeModule:()=>f,serverHooks:()=>v,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>g});var n={};t.r(n),t.d(n,{GET:()=>p,HEAD:()=>m});var o=t(6559),a=t(8088),s=t(7719),i=t(2190),u=t(5807);let l={allowedMethods:["GET","POST","PUT","DELETE","OPTIONS"],corsOrigins:["*"],rateLimit:{requests:100,windowMs:6e4},timeout:3e4,cache:{enabled:!1,ttl:300},auth:{required:!1,type:"api-key"}};async function d(e,r){let t=e.headers.get("Authorization");if(!t)return{valid:!1,reason:"Missing Authorization header"};switch(r.type){case"bearer":if(!t.startsWith("Bearer "))return{valid:!1,reason:"Invalid Bearer token format"};return{valid:!0};case"api-key":if(!t.startsWith("ApiKey "))return{valid:!1,reason:"Invalid API key format"};return{valid:!0};case"custom":return{valid:!0};default:return{valid:!1,reason:"Unknown auth type"}}}var c=t(5697);async function h(){let e={kv:"unknown",d1:"unknown",r2:"unknown"};try{if("undefined"!=typeof globalThis&&globalThis.CACHE)try{await globalThis.CACHE.get("health-check"),e.kv="available"}catch(r){e.kv="error"}else e.kv="not-configured";"undefined"!=typeof globalThis&&globalThis.DB?e.d1="available":e.d1="not-configured","undefined"!=typeof globalThis&&globalThis.ASSETS?e.r2="available":e.r2="not-configured"}catch(e){(0,u.Rm)("warn","Error checking Cloudflare services",{error:e instanceof Error?e.message:"Unknown error"})}return e}let p=function(e,r={}){let t={...l,...r};return async function(r,n){let o=(0,u.LF)(r),a=Date.now();try{(0,u.Rm)("info",`API Request: ${r.method} ${r.url}`,{method:r.method,url:r.url,userAgent:r.headers.get("user-agent"),ip:o.ip},o.id);let s=(0,u.QU)(r,t.corsOrigins);if(s)return s;if(!t.allowedMethods?.includes(r.method))return(0,u.WX)(405,`Method ${r.method} not allowed`,{allowedMethods:t.allowedMethods},o);if(t.rateLimit){let e=o.ip||"unknown";if(!(0,u.Eb)(e,t.rateLimit.requests,t.rateLimit.windowMs))return(0,u.WX)(429,"Too many requests",{limit:t.rateLimit.requests,windowMs:t.rateLimit.windowMs},o)}if(t.auth?.required){let e=await d(r,t.auth);if(!e.valid)return(0,u.WX)(401,"Authentication required",{reason:e.reason},o)}let i=await Promise.race([(0,u.xd)(()=>e(r,n),`${r.method} ${new URL(r.url).pathname}`,o),new Promise((e,r)=>{setTimeout(()=>{r(Error("Request timeout"))},t.timeout)})]),l=(0,u.co)(i,{"X-Powered-By":"Recipe-Genius/Cloudflare","X-Environment":(0,u.de)()?"cloudflare-workers":"nodejs"},o),c=Date.now()-a;return(0,u.Rm)("info",`API Response: ${l.status}`,{status:l.status,duration:c,method:r.method,url:r.url},o.id),l}catch(n){let e=Date.now()-a;if((0,u.Rm)("error","API Error",{error:n instanceof Error?n.message:"Unknown error",stack:n instanceof Error?n.stack:void 0,duration:e,method:r.method,url:r.url},o.id),n instanceof Error&&"Request timeout"===n.message)return(0,u.WX)(408,"Request timeout",{timeout:t.timeout},o);return(0,u.WX)(500,"Internal server error",(0,u.de)()?void 0:{message:n instanceof Error?n.message:"Unknown error"},o)}}}(async function e(e){let r=Date.now();try{let e={timestamp:new Date().toISOString(),environment:(0,u.lh)("NODE_ENV","unknown"),runtime:(0,u.de)()?"cloudflare-workers":"nodejs",version:(0,u.lh)("APP_VERSION","1.0.0"),buildTime:(0,u.lh)("BUILD_TIMESTAMP","unknown")},t=(0,c.In)(),n={configured:t.length,available:t.map(e=>e.name),total:5},o={hasAppUrl:!!(0,u.lh)("NEXT_PUBLIC_APP_URL"),hasNodeEnv:!!(0,u.lh)("NODE_ENV"),cloudflareWorkers:(0,u.de)()},a=await h(),s={responseTime:Date.now()-r,memoryUsage:function(){try{if((0,u.de)());else if("undefined"!=typeof process&&process.memoryUsage){let e=process.memoryUsage();return{used:Math.round(e.heapUsed/1024/1024),total:Math.round(e.heapTotal/1024/1024),percentage:Math.round(e.heapUsed/e.heapTotal*100)}}}catch(e){}return{used:"unknown",total:"unknown",percentage:"unknown"}}(),uptime:function(){try{if((0,u.de)())return"stateless";if("undefined"!=typeof process&&process.uptime){let e=process.uptime(),r=Math.floor(e/3600),t=Math.floor(e%3600/60),n=Math.floor(e%60);return`${r}h ${t}m ${n}s`}}catch(e){}return"unknown"}()},l=n.configured>0&&o.hasAppUrl&&o.hasNodeEnv&&s.responseTime<5e3,d={status:l?"healthy":"degraded",timestamp:e.timestamp,system:e,ai:n,environment:o,cloudflare:a,performance:s,checks:{aiProviders:n.configured>0,environment:o.hasAppUrl&&o.hasNodeEnv,performance:s.responseTime<5e3,cloudflareServices:"error"!==a.kv}};return(0,u.Rm)("info","Health check completed",{status:d.status,responseTime:s.responseTime,aiProviders:n.configured,runtime:e.runtime}),i.NextResponse.json(d,{status:l?200:503,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate","X-Health-Status":d.status,"X-Response-Time":`${s.responseTime}ms`}})}catch(t){let e=Date.now()-r;return(0,u.Rm)("error","Health check failed",{error:t instanceof Error?t.message:"Unknown error",responseTime:e}),i.NextResponse.json({status:"error",timestamp:new Date().toISOString(),error:"Health check failed",performance:{responseTime:e}},{status:500,headers:{"Content-Type":"application/json","X-Health-Status":"error","X-Response-Time":`${e}ms`}})}},{allowedMethods:["GET"],corsOrigins:["*"],rateLimit:{requests:1e3,windowMs:6e4},timeout:5e3,cache:{enabled:!0,ttl:60}});async function m(e){try{let e=(0,c.In)(),r=e.length>0;return new Response(null,{status:r?200:503,headers:{"X-Health-Status":r?"healthy":"degraded","X-AI-Providers":e.length.toString(),"X-Runtime":(0,u.de)()?"cloudflare-workers":"nodejs"}})}catch(e){return new Response(null,{status:500,headers:{"X-Health-Status":"error"}})}}let f=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/health/route",pathname:"/api/health",filename:"route",bundlePath:"app/api/health/route"},resolvedPagePath:"/Users/zorro/Documents/augment-projects/cooker/recipe-genius/app/api/health/route.ts",nextConfigOutput:"standalone",userland:n}),{workAsyncStorage:w,workUnitAsyncStorage:g,serverHooks:v}=f;function k(){return(0,s.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:g})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[447,580,117],()=>t(9982));module.exports=n})();