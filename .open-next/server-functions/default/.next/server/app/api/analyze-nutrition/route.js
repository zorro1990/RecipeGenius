"use strict";(()=>{var e={};e.id=45,e.ids=[45],e.modules={628:(e,r,t)=>{t.d(r,{Sk:()=>c,X7:()=>o,bD:()=>a,gx:()=>s,l3:()=>u});var n=t(6819),i=t(5697);async function s(e,r,t,s){try{let o=i.XV.replace("{ingredients}",e.join(", ")).replace("{preferences}",r.dietaryRestrictions.join(", ")).replace("{timeLimit}",r.cookingTime.toString()).replace("{servings}",r.servings.toString()).replace("{difficulty}",r.difficulty),a=await (0,i.jn)(o,t,s),u=(0,n.O)(a);if(!u)throw Error("无法从响应中提取有效的JSON");let c=(0,n.$l)(u,null);if(!c)throw Error("无法解析菜谱JSON数据");if(!c.title||!c.ingredients||!c.steps)throw Error("菜谱数据不完整，缺少必需字段");return{id:(0,n.$C)(),title:c.title,description:c.description||"",ingredients:Array.isArray(c.ingredients)?c.ingredients.map(e=>({name:e.name||"",quantity:e.quantity||"",unit:e.unit||""})):[],steps:Array.isArray(c.steps)?c.steps:[],cookingTime:"number"==typeof c.cookingTime?c.cookingTime:r.cookingTime,servings:"number"==typeof c.servings?c.servings:r.servings,difficulty:["easy","medium","hard"].includes(c.difficulty)?c.difficulty:r.difficulty,nutrition:c.nutrition?{calories:c.nutrition.calories||0,protein:c.nutrition.protein||0,carbs:c.nutrition.carbs||0,fat:c.nutrition.fat||0,fiber:c.nutrition.fiber||0}:{calories:0,protein:0,carbs:0,fat:0,fiber:0},tags:Array.isArray(c.tags)?c.tags:[],tips:Array.isArray(c.tips)?c.tips:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}catch(e){throw console.error("生成菜谱失败:",e),Error(`生成菜谱失败: ${e instanceof Error?e.message:"未知错误"}`)}}async function o(e){try{let r=i.hI.replace("{title}",e.title).replace("{ingredients}",e.ingredients.map(e=>`${e.name} ${e.quantity}${e.unit}`).join(", ")).replace("{servings}",e.servings.toString()),t=await (0,i.callAI)(r),s=(0,n.O)(t);if(!s)throw Error("无法从响应中提取营养信息JSON");let o=(0,n.$l)(s,null);if(!o)throw Error("无法解析营养信息JSON数据");return{calories:o.calories||0,protein:o.protein||0,carbs:o.carbs||0,fat:o.fat||0,fiber:o.fiber||0}}catch(e){throw console.error("营养分析失败:",e),Error(`营养分析失败: ${e instanceof Error?e.message:"未知错误"}`)}}async function a(e,r=3,t=1e3){for(let n=0;n<r;n++)try{return await e()}catch(e){if(n===r-1)throw e;await new Promise(e=>setTimeout(e,t*(n+1)))}throw Error("Max retries exceeded")}async function u(){try{let e=(0,i.In)();if(0===e.length)return{success:!1,provider:"none",message:"没有配置任何AI提供商",error:"请在环境变量中配置至少一个API密钥"};return await (0,i.callAI)('请回复"连接成功"'),{success:!0,provider:e[0].name,message:`AI连接成功，使用提供商: ${e[0].name}`}}catch(e){return{success:!1,provider:"unknown",message:"AI连接失败",error:e instanceof Error?e.message:"未知错误"}}}function c(){let e=(0,i.In)(),r=e.filter(e=>"doubao"!==e.name);return{available:e.map(e=>e.name),configured:e.length,recommended:e.length>0?e[0].name:"none",recipeProviders:r.map(e=>e.name)}}},846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3131:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>g});var n={};t.r(n),t.d(n,{GET:()=>p,POST:()=>l});var i=t(6559),s=t(8088),o=t(7719),a=t(2190),u=t(628),c=t(6819);async function l(e){try{let{recipe:r}=await e.json();if(!r)return a.NextResponse.json({success:!1,error:"请提供菜谱信息"},{status:400});if(!r.title||!r.ingredients||0===r.ingredients.length)return a.NextResponse.json({success:!1,error:"菜谱信息不完整"},{status:400});let t=await (0,u.bD)(()=>(0,u.X7)(r),3,1500),n=function(e,r){let t=[],n=e.calories/r;n>600?t.push("这道菜热量较高，建议搭配清淡的蔬菜或汤品"):n<200&&t.push("这道菜热量较低，可以作为轻食或配菜");let i=e.protein/r;i>25?t.push("蛋白质含量丰富，适合健身或需要补充蛋白质的人群"):i<10&&t.push("蛋白质含量较低，建议搭配肉类、蛋类或豆制品");let s=e.fiber/r;s>8?t.push("膳食纤维丰富，有助于消化和肠道健康"):s<3&&t.push("建议增加蔬菜或全谷物来提高膳食纤维含量");let o=e.fat/r;return o>20?t.push("脂肪含量较高，建议适量食用"):o<5&&t.push("脂肪含量较低，可以适当添加健康油脂如橄榄油"),e.carbs/r>50&&t.push("碳水化合物含量较高，适合运动前后食用"),0===t.length&&t.push("营养搭配均衡，是一道健康的菜品"),t}(t,r.servings);return a.NextResponse.json({success:!0,data:{nutrition:t,recommendations:n},message:"营养分析完成"})}catch(t){console.error("营养分析API错误:",t);let e="营养分析失败，请稍后重试",r=500;return t instanceof Error&&(t.message.includes("API key")?(e="AI服务配置错误，请联系管理员",r=503):t.message.includes("quota")||t.message.includes("limit")?(e="AI服务暂时不可用，请稍后重试",r=503):e=(0,c.NR)(t)),a.NextResponse.json({success:!1,error:e},{status:r})}}async function p(){return a.NextResponse.json({success:!1,error:"不支持的请求方法"},{status:405})}let d=new i.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/analyze-nutrition/route",pathname:"/api/analyze-nutrition",filename:"route",bundlePath:"app/api/analyze-nutrition/route"},resolvedPagePath:"/Users/zorro/Documents/augment-projects/cooker/recipe-genius/app/api/analyze-nutrition/route.ts",nextConfigOutput:"standalone",userland:n}),{workAsyncStorage:f,workUnitAsyncStorage:g,serverHooks:m}=d;function y(){return(0,o.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:g})}},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6819:(e,r,t)=>{function n(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function i(e){return e.map(e=>e.trim()).filter(e=>e.trim().length>0&&e.trim().length<=50).filter((e,r,t)=>t.indexOf(e)===r)}function s(e){return e instanceof Error?e.message:"string"==typeof e?e:"发生了未知错误"}function o(e){let r=e.match(/\{[\s\S]*\}/);return r?r[0]:null}function a(e,r=null){try{return JSON.parse(e)}catch{return r}}t.d(r,{$C:()=>n,$l:()=>a,NR:()=>s,O:()=>o,iX:()=>i})},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[447,580,117],()=>t(3131));module.exports=n})();