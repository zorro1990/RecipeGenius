(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[653],{4964:(e,s,a)=>{"use strict";a.d(s,{Xi:()=>c,av:()=>d,j7:()=>n,tU:()=>i});var t=a(5155);a(2115);var l=a(1724),r=a(3999);function i(e){let{className:s,...a}=e;return(0,t.jsx)(l.bL,{"data-slot":"tabs",className:(0,r.cn)("flex flex-col gap-2",s),...a})}function n(e){let{className:s,...a}=e;return(0,t.jsx)(l.B8,{"data-slot":"tabs-list",className:(0,r.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",s),...a})}function c(e){let{className:s,...a}=e;return(0,t.jsx)(l.l9,{"data-slot":"tabs-trigger",className:(0,r.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...a})}function d(e){let{className:s,...a}=e;return(0,t.jsx)(l.UC,{"data-slot":"tabs-content",className:(0,r.cn)("flex-1 outline-none",s),...a})}},5261:(e,s,a)=>{Promise.resolve().then(a.bind(a,6553))},6553:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>el});var t=a(5155),l=a(2115),r=a(5695),i=a(8482),n=a(7168),c=a(4964),d=a(9852),o=a(8145),x=a(744),m=a(7924),u=a(4616),h=a(3311),g=a(2525),j=a(4416),p=a(3999);let f={vegetables:{name:"蔬菜类",icon:"\uD83E\uDD6C",items:["白菜","菠菜","生菜","芹菜","韭菜","小白菜","油菜","茼蒿"]},roots:{name:"根茎类",icon:"\uD83E\uDD55",items:["土豆","红薯","胡萝卜","白萝卜","洋葱","大蒜","生姜","莲藕"]},proteins:{name:"蛋白质",icon:"\uD83E\uDD69",items:["鸡蛋","鸡肉","猪肉","牛肉","鱼肉","虾","豆腐","腊肉"]},seasonings:{name:"调料类",icon:"\uD83E\uDDC2",items:["盐","生抽","老抽","料酒","醋","糖","胡椒粉","花椒"]},others:{name:"其他",icon:"\uD83C\uDF36️",items:["青椒","红椒","西红柿","黄瓜","茄子","豆角","冬瓜","南瓜"]}},N=["鸡蛋","西红柿","土豆","洋葱","大蒜","生姜","胡萝卜","青椒","白菜","豆腐","鸡肉","猪肉","牛肉","鱼肉","虾","韭菜","芹菜","菠菜","茄子","黄瓜","豆角","冬瓜","南瓜","莲藕"];function v(e){let{onIngredientsChange:s,initialIngredients:a=[]}=e,[r,c]=(0,l.useState)(a),[v,b]=(0,l.useState)(""),[y,A]=(0,l.useState)(null),[k,w]=(0,l.useState)(!1),[z,I]=(0,l.useState)([]),[C,_]=(0,l.useState)(null),R=(0,l.useRef)(null);(0,l.useEffect)(()=>{if(v.trim()){let e=N.filter(e=>e.includes(v.trim())&&!r.includes(e));I(e.slice(0,6)),w(e.length>0)}else w(!1),I([])},[v,r]);let S=e=>{var a;A(null);let t=e||v.trim();if(!t)return void A("请输入食材名称");if(!(0,p.o1)(t))return void A("食材名称长度应在1-50个字符之间");if(r.includes(t))return void A("该食材已经添加过了");let l=[...r,t];c(l),s(l),b(""),w(!1),null==(a=R.current)||a.focus()},E=e=>{let a=r.filter((s,a)=>a!==e);c(a),s(a)},P=e=>{let a=(0,p.iX)([...r,...e.split(/[,，、\n]/)]);c(a),s(a)},T=e=>{r.includes(e)||S(e)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(i.Zp,{className:"border-2 border-dashed border-orange-200 bg-orange-50/30",children:(0,t.jsx)(i.Wu,{className:"p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(x.A,{className:"size-8 text-orange-500 mx-auto mb-2"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"添加你的食材"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"输入现有食材，AI将为你推荐最佳搭配"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(m.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 size-5"}),(0,t.jsx)(d.p,{ref:R,placeholder:"搜索或输入食材名称...",value:v,onChange:e=>{b(e.target.value),A(null)},onKeyPress:e=>{"Enter"===e.key?(e.preventDefault(),S()):"Escape"===e.key&&w(!1)},onFocus:()=>v&&w(!0),onBlur:()=>setTimeout(()=>w(!1),200),className:"pl-10 h-12 text-base border-2 focus:border-orange-400",maxLength:50}),k&&z.length>0&&(0,t.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:z.map((e,s)=>(0,t.jsx)("button",{className:"w-full px-4 py-2 text-left hover:bg-orange-50 transition-colors border-b border-gray-100 last:border-b-0",onClick:()=>S(e),children:(0,t.jsx)("span",{className:"text-gray-700",children:e})},s))})]}),(0,t.jsxs)(n.$,{onClick:()=>S(),size:"lg",disabled:!v.trim(),className:"h-12 px-6 bg-orange-500 hover:bg-orange-600",children:[(0,t.jsx)(u.A,{className:"size-5 mr-2"}),"添加"]})]}),y&&(0,t.jsx)("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-red-700",children:y})})]})]})})}),r.length>0?(0,t.jsx)(i.Zp,{children:(0,t.jsxs)(i.Wu,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(h.A,{className:"size-5 text-green-500"}),(0,t.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["已选食材 (",r.length,")"]})]}),(0,t.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{c([]),s([])},className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[(0,t.jsx)(g.A,{className:"size-4 mr-1"}),"清空"]})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-3",children:r.map((e,s)=>(0,t.jsxs)(o.E,{variant:"secondary",className:"flex items-center gap-2 px-4 py-2 text-sm bg-green-100 text-green-800 hover:bg-green-200 transition-colors",children:[(0,t.jsx)("span",{className:"font-medium",children:e}),(0,t.jsx)(j.A,{className:"size-4 cursor-pointer hover:text-red-600 transition-colors",onClick:()=>E(s)})]},s))}),(0,t.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:(0,t.jsxs)("p",{className:"text-sm text-blue-700",children:["\uD83D\uDCA1 已有 ",r.length," 种食材，可以生成丰富的菜谱了！继续添加更多食材获得更多选择。"]})})]})}):(0,t.jsx)(i.Zp,{className:"border-dashed border-gray-300",children:(0,t.jsx)(i.Wu,{className:"p-8",children:(0,t.jsxs)("div",{className:"text-center text-gray-500",children:[(0,t.jsx)("div",{className:"text-6xl mb-4",children:"\uD83E\uDD55"}),(0,t.jsx)("h3",{className:"text-lg font-medium mb-2",children:"还没有添加任何食材"}),(0,t.jsx)("p",{className:"text-sm",children:"开始输入你现有的食材，让AI为你创造美味菜谱！"})]})})}),(0,t.jsx)(i.Zp,{children:(0,t.jsx)(i.Wu,{className:"p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-2xl",children:"\uD83C\uDFEA"}),"快速添加常见食材"]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:Object.entries(f).map(e=>{let[s,a]=e;return(0,t.jsxs)(n.$,{variant:C===s?"default":"outline",size:"sm",onClick:()=>_(C===s?null:s),className:"text-sm",children:[(0,t.jsx)("span",{className:"mr-1",children:a.icon}),a.name]},s)})}),C?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("h4",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,t.jsx)("span",{children:f[C].icon}),f[C].name]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:f[C].items.map(e=>(0,t.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>T(e),disabled:r.includes(e),className:"text-sm transition-all ".concat(r.includes(e)?"opacity-50 cursor-not-allowed":"hover:bg-orange-50 hover:border-orange-300"),children:[e,r.includes(e)&&(0,t.jsx)("span",{className:"ml-1 text-green-500",children:"✓"})]},e))})]}):(0,t.jsx)("div",{className:"text-center py-6 text-gray-500",children:(0,t.jsx)("p",{className:"text-sm",children:"选择一个分类查看相关食材"})})]})})}),(0,t.jsx)(i.Zp,{children:(0,t.jsx)(i.Wu,{className:"p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCDD"}),"批量输入食材"]}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"粘贴食材清单，支持逗号、换行或顿号分隔，一次性添加多个食材"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("textarea",{placeholder:"例如：鸡蛋、西红柿、土豆 洋葱，大蒜，生姜 胡萝卜、青椒",className:"w-full p-4 border-2 border-gray-200 rounded-lg resize-none focus:border-orange-400 focus:outline-none transition-colors",rows:4,onBlur:e=>{e.target.value.trim()&&(P(e.target.value),e.target.value="")}}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 bg-gray-50 p-3 rounded-lg",children:[(0,t.jsx)("p",{className:"font-medium mb-1",children:"支持的分隔符："}),(0,t.jsx)("p",{children:"• 逗号（,）• 中文逗号（，）• 顿号（、）• 换行"})]})]})]})})})]})}var b=a(7943);function y(e){let{className:s,defaultValue:a,value:r,min:i=0,max:n=100,...c}=e,d=l.useMemo(()=>Array.isArray(r)?r:Array.isArray(a)?a:[i,n],[r,a,i,n]);return(0,t.jsxs)(b.bL,{"data-slot":"slider",defaultValue:a,value:r,min:i,max:n,className:(0,p.cn)("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",s),...c,children:[(0,t.jsx)(b.CC,{"data-slot":"slider-track",className:(0,p.cn)("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:(0,t.jsx)(b.Q6,{"data-slot":"slider-range",className:(0,p.cn)("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:d.length},(e,s)=>(0,t.jsx)(b.zi,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},s))]})}let A=["素食","纯素食","无麸质","低卡路里","低盐","低糖","高蛋白","生酮饮食"],k=["中式","西式","日式","韩式","泰式","意式","法式","印度菜","墨西哥菜"],w=["花生","坚果","牛奶","鸡蛋","大豆","小麦","鱼类","贝类"];var z=a(4186),I=a(7580),C=a(1243);function _(e){let{onPreferencesChange:s,initialPreferences:a={}}=e,[r,c]=(0,l.useState)({dietaryRestrictions:a.dietaryRestrictions||[],cuisineType:a.cuisineType||[],cookingTime:a.cookingTime||30,servings:a.servings||2,difficulty:a.difficulty||"easy",allergies:a.allergies||[]}),d=e=>{let a={...r,...e};c(a),s(a)},m=(e,s)=>e.includes(s)?e.filter(e=>e!==s):[...e,s];return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(i.Zp,{children:[(0,t.jsxs)(i.aR,{children:[(0,t.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(z.A,{className:"size-5 text-blue-500"}),"烹饪时间和份数"]}),(0,t.jsx)(i.BT,{children:"设置你的时间限制和用餐人数"})]}),(0,t.jsxs)(i.Wu,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("label",{className:"text-sm font-medium flex items-center justify-between",children:[(0,t.jsx)("span",{children:"最大烹饪时间"}),(0,t.jsxs)("span",{className:"text-orange-500 font-semibold",children:[r.cookingTime,"分钟"]})]}),(0,t.jsx)(y,{value:[r.cookingTime],onValueChange:e=>{let[s]=e;return d({cookingTime:s})},max:120,min:10,step:5,className:"w-full"}),(0,t.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,t.jsx)("span",{children:"10分钟"}),(0,t.jsx)("span",{children:"60分钟"}),(0,t.jsx)("span",{children:"120分钟"})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("label",{className:"text-sm font-medium flex items-center justify-between",children:[(0,t.jsx)("span",{children:"用餐人数"}),(0,t.jsxs)("span",{className:"text-orange-500 font-semibold",children:[r.servings,"人"]})]}),(0,t.jsx)(y,{value:[r.servings],onValueChange:e=>{let[s]=e;return d({servings:s})},max:8,min:1,step:1,className:"w-full"}),(0,t.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,t.jsx)("span",{children:"1人"}),(0,t.jsx)("span",{children:"4人"}),(0,t.jsx)("span",{children:"8人"})]})]})]})]}),(0,t.jsxs)(i.Zp,{children:[(0,t.jsxs)(i.aR,{children:[(0,t.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(x.A,{className:"size-5 text-green-500"}),"烹饪难度"]}),(0,t.jsx)(i.BT,{children:"选择适合你技能水平的难度"})]}),(0,t.jsx)(i.Wu,{children:(0,t.jsx)("div",{className:"grid grid-cols-3 gap-3",children:[{value:"easy",label:"简单",desc:"基础操作"},{value:"medium",label:"中等",desc:"需要一些技巧"},{value:"hard",label:"困难",desc:"挑战性强"}].map(e=>(0,t.jsxs)(n.$,{variant:r.difficulty===e.value?"default":"outline",onClick:()=>d({difficulty:e.value}),className:"h-auto p-4 flex flex-col items-center gap-2",children:[(0,t.jsx)("span",{className:"font-medium",children:e.label}),(0,t.jsx)("span",{className:"text-xs opacity-70",children:e.desc})]},e.value))})})]}),(0,t.jsxs)(i.Zp,{children:[(0,t.jsxs)(i.aR,{children:[(0,t.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(I.A,{className:"size-5 text-purple-500"}),"饮食偏好"]}),(0,t.jsx)(i.BT,{children:"选择你的饮食限制和偏好"})]}),(0,t.jsxs)(i.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"饮食限制"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:A.map(e=>(0,t.jsx)(o.E,{variant:r.dietaryRestrictions.includes(e)?"default":"outline",className:"cursor-pointer hover:bg-primary/80",onClick:()=>d({dietaryRestrictions:m(r.dietaryRestrictions,e)}),children:e},e))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"菜系偏好"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:k.map(e=>(0,t.jsx)(o.E,{variant:r.cuisineType.includes(e)?"default":"outline",className:"cursor-pointer hover:bg-primary/80",onClick:()=>d({cuisineType:m(r.cuisineType,e)}),children:e},e))})]})]})]}),(0,t.jsxs)(i.Zp,{children:[(0,t.jsxs)(i.aR,{children:[(0,t.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(C.A,{className:"size-5 text-red-500"}),"过敏原提醒"]}),(0,t.jsx)(i.BT,{children:"选择你需要避免的过敏原"})]}),(0,t.jsxs)(i.Wu,{children:[(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:w.map(e=>{var s;return(0,t.jsx)(o.E,{variant:(null==(s=r.allergies)?void 0:s.includes(e))?"destructive":"outline",className:"cursor-pointer",onClick:()=>d({allergies:m(r.allergies||[],e)}),children:e},e)})}),r.allergies&&r.allergies.length>0&&(0,t.jsxs)("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,t.jsxs)("p",{className:"text-sm text-red-700",children:["⚠️ 已选择过敏原：",r.allergies.join("、")]}),(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"生成的菜谱将避免使用这些食材"})]})]})]}),(0,t.jsxs)(i.Zp,{className:"bg-orange-50 border-orange-200",children:[(0,t.jsx)(i.aR,{children:(0,t.jsx)(i.ZB,{className:"text-orange-800",children:"偏好总结"})}),(0,t.jsx)(i.Wu,{className:"text-sm text-orange-700",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"烹饪时间："}),r.cookingTime,"分钟以内"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"用餐人数："}),r.servings,"人"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"难度："}),"easy"===r.difficulty?"简单":"medium"===r.difficulty?"中等":"困难"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"限制："}),r.dietaryRestrictions.length>0?r.dietaryRestrictions.join("、"):"无特殊限制"]})]})})]})]})}var R=a(9941),S=a(381),E=a(646),P=a(2796);function T(e){let{onOpenSettings:s,className:a=""}=e,[r,i]=(0,l.useState)(!1),[c,d]=(0,l.useState)([]),[o,x]=(0,l.useState)(!1);(0,l.useEffect)(()=>{x(!0),m()},[]);let m=()=>{i((0,P.hasAnyAPIKey)()),d((0,P.getConfiguredProviders)())};if((0,l.useEffect)(()=>{if(!o)return;let e=()=>{m()};window.addEventListener("storage",e);let s=setInterval(m,1e3);return()=>{window.removeEventListener("storage",e),clearInterval(s)}},[o]),!o)return null;let u=(()=>{if(!r)return{icon:(0,t.jsx)(S.A,{className:"size-4 text-orange-500"}),text:"配置AI服务",variant:"outline",description:"点击配置AI提供商",className:"border-orange-200 text-orange-700 hover:bg-orange-50"};if(1===c.length){let e=c[0],s=P.API_PROVIDERS[e];return{icon:(0,t.jsx)(E.A,{className:"size-4 text-green-500"}),text:"AI已就绪",variant:"outline",description:"使用".concat((null==s?void 0:s.name)||e),className:"border-green-200 text-green-700 hover:bg-green-50"}}return{icon:(0,t.jsx)(E.A,{className:"size-4 text-blue-500"}),text:"".concat(c.length,"个AI服务"),variant:"outline",description:"多个提供商已配置",className:"border-blue-200 text-blue-700 hover:bg-blue-50"}})();return(0,t.jsxs)(n.$,{variant:u.variant,size:"sm",onClick:s,className:"flex items-center gap-2 h-auto px-3 py-2 ".concat(u.className||""," ").concat(a),title:u.description,children:[u.icon,(0,t.jsx)("span",{className:"text-sm font-medium",children:u.text})]})}var D=a(5863);let Z=l.forwardRef((e,s)=>{let{className:a,value:l,...r}=e;return(0,t.jsx)(D.bL,{ref:s,className:(0,p.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",a),...r,children:(0,t.jsx)(D.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(l||0),"%)")}})})});Z.displayName=D.bL.displayName;let B=(0,a(2085).F)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),O=l.forwardRef((e,s)=>{let{className:a,variant:l,...r}=e;return(0,t.jsx)("div",{ref:s,role:"alert",className:(0,p.cn)(B({variant:l}),a),...r})});O.displayName="Alert",l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("h5",{ref:s,className:(0,p.cn)("mb-1 font-medium leading-none tracking-tight",a),...l})}).displayName="AlertTitle";let W=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,p.cn)("text-sm [&_p]:leading-relaxed",a),...l})});W.displayName="AlertDescription";var $=a(1154),U=a(9869),M=a(2118),K=a(4355),L=a(5339);function F(e){let{onImageSelect:s,onImageRemove:a,isUploading:r=!1,maxSizeInMB:c=5,acceptedFormats:d=["image/jpeg","image/png","image/webp"],className:o=""}=e,[x,m]=(0,l.useState)(null),[u,h]=(0,l.useState)(!1),[g,p]=(0,l.useState)(null),[f,N]=(0,l.useState)(0),v=(0,l.useRef)(null),b=(0,l.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.8;return new Promise(a=>{let t=document.createElement("canvas"),l=t.getContext("2d"),r=new Image;r.onload=()=>{let{width:e,height:i}=r;e>i?e>1024&&(i=1024*i/e,e=1024):i>1024&&(e=1024*e/i,i=1024),t.width=e,t.height=i,null==l||l.drawImage(r,0,0,e,i),a(t.toDataURL("image/jpeg",s))},r.src=URL.createObjectURL(e)})},[]),y=(0,l.useCallback)(e=>{if(!d.includes(e.type))return"不支持的文件格式。请选择 ".concat(d.map(e=>e.split("/")[1].toUpperCase()).join(", ")," 格式的图片。");let s=1024*c*1024;return e.size>s?"文件大小超过限制。请选择小于 ".concat(c,"MB 的图片。"):null},[d,c]),A=(0,l.useCallback)(async e=>{p(null),N(0);let a=y(e);if(a)return void p(a);try{let a=URL.createObjectURL(e),t=setInterval(()=>{N(e=>e>=90?(clearInterval(t),90):e+10)},100),l=await b(e),r=Math.round(3*l.length/4);clearInterval(t),N(100);let i={file:e,dataUrl:a,compressedDataUrl:l,originalSize:e.size,compressedSize:r};m(i),s(e,l),setTimeout(()=>N(0),1e3)}catch(e){console.error("图片处理失败:",e),p("图片处理失败，请重试。"),N(0)}},[y,b,s]),k=(0,l.useCallback)(e=>{e.preventDefault(),h(!0)},[]),w=(0,l.useCallback)(e=>{e.preventDefault(),h(!1)},[]),z=(0,l.useCallback)(e=>{e.preventDefault(),h(!1);let s=Array.from(e.dataTransfer.files);s.length>0&&A(s[0])},[A]),I=(0,l.useCallback)(()=>{var e;null==(e=v.current)||e.click()},[]),C=(0,l.useCallback)(e=>{let s=e.target.files;s&&s.length>0&&A(s[0])},[A]),_=(0,l.useCallback)(()=>{m(null),p(null),N(0),v.current&&(v.current.value=""),a()},[a]),R=e=>{if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]};return(0,t.jsxs)("div",{className:"space-y-4 ".concat(o),children:[!x&&(0,t.jsx)(i.Zp,{className:"border-2 border-dashed transition-all duration-200 cursor-pointer hover:border-primary/50 ".concat(u?"border-primary bg-primary/5":"border-gray-300"," ").concat(r?"pointer-events-none opacity-50":""),onDragOver:k,onDragLeave:w,onDrop:z,onClick:I,children:(0,t.jsxs)(i.Wu,{className:"flex flex-col items-center justify-center p-8 text-center",children:[r?(0,t.jsx)($.A,{className:"size-12 text-primary animate-spin mb-4"}):(0,t.jsx)("div",{className:"flex items-center justify-center size-16 bg-primary/10 rounded-full mb-4",children:(0,t.jsx)(U.A,{className:"size-8 text-primary"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:r?"识别中...":"上传食材图片"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:r?"AI正在识别图片中的食材，请稍候...":"拖拽图片到此处，或点击选择文件"}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(M.A,{className:"size-4"}),(0,t.jsx)("span",{children:"JPG, PNG, WebP"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(K.A,{className:"size-4"}),(0,t.jsxs)("span",{children:["最大 ",c,"MB"]})]})]})]})}),f>0&&f<100&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{children:"正在处理图片..."}),(0,t.jsxs)("span",{children:[f,"%"]})]}),(0,t.jsx)(Z,{value:f,className:"h-2"})]}),x&&(0,t.jsx)(i.Zp,{children:(0,t.jsx)(i.Wu,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("img",{src:x.dataUrl,alt:"预览",className:"w-24 h-24 object-cover rounded-lg border"}),(0,t.jsx)(n.$,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0",onClick:_,children:(0,t.jsx)(j.A,{className:"size-3"})})]}),(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium",children:x.file.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["原始大小: ",R(x.originalSize)]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["压缩后: ",R(x.compressedSize),(0,t.jsxs)("span",{className:"text-green-600 ml-1",children:["(节省 ",Math.round((1-x.compressedSize/x.originalSize)*100),"%)"]})]})]}),r&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[(0,t.jsx)($.A,{className:"size-4 animate-spin"}),(0,t.jsx)("span",{children:"AI正在识别食材..."})]})]})]})})}),g&&(0,t.jsxs)(O,{variant:"destructive",children:[(0,t.jsx)(L.A,{className:"size-4"}),(0,t.jsx)(W,{children:g})]}),(0,t.jsx)("input",{ref:v,type:"file",accept:d.join(","),onChange:C,className:"hidden"})]})}var G=a(5196),q=a(6287),J=a(8749),V=a(2657);function X(e){var s,a;let{result:r,onConfirm:c,onRetry:x,onCancel:m,isLoading:p=!1,className:f=""}=e,[N,v]=(0,l.useState)(r.ingredients),[b,y]=(0,l.useState)(""),[A,k]=(0,l.useState)(null),[w,I]=(0,l.useState)(""),[C,_]=(0,l.useState)(!0),R=(0,l.useCallback)(()=>{b.trim()&&!N.includes(b.trim())&&(v(e=>[...e,b.trim()]),y(""))},[b,N]),S=(0,l.useCallback)(e=>{v(s=>s.filter((s,a)=>a!==e))},[]),P=(0,l.useCallback)(e=>{k(e),I(N[e])},[N]),T=(0,l.useCallback)(()=>{null!==A&&w.trim()&&v(e=>e.map((e,s)=>s===A?w.trim():e)),k(null),I("")},[A,w]),D=(0,l.useCallback)(()=>{k(null),I("")},[]),Z=(0,l.useCallback)(e=>{N.includes(e)||v(s=>[...s,e])},[N]),B=(0,l.useCallback)(()=>{c(N.filter(e=>e.trim().length>0))},[N,c]);return(0,t.jsxs)("div",{className:"space-y-4 ".concat(f),children:[(0,t.jsxs)(i.Zp,{children:[(0,t.jsx)(i.aR,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(h.A,{className:"size-5 text-primary"}),"AI识别结果"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(o.E,{variant:"outline",className:(s=r.confidence)>=.8?"text-green-600":s>=.6?"text-yellow-600":"text-red-600",children:[(100*r.confidence).toFixed(0),"% 准确度"]}),r.processingTime&&(0,t.jsxs)(o.E,{variant:"outline",className:"text-gray-600",children:[(0,t.jsx)(z.A,{className:"size-3 mr-1"}),(r.processingTime/1e3).toFixed(1),"s"]})]})]})}),(0,t.jsxs)(i.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"图片描述："}),(0,t.jsx)("p",{className:"text-sm bg-gray-50 p-2 rounded",children:r.description})]}),r.confidence<.6&&(0,t.jsxs)(O,{children:[(0,t.jsx)(L.A,{className:"size-4"}),(0,t.jsxs)(W,{children:[(a=r.confidence)>=.8?"识别准确度高":a>=.6?"识别准确度中等":"识别准确度较低，请仔细检查","，建议手动检查和调整识别结果。"]})]})]})]}),(0,t.jsxs)(i.Zp,{children:[(0,t.jsx)(i.aR,{className:"pb-3",children:(0,t.jsxs)(i.ZB,{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{children:["识别的食材 (",N.length,")"]}),(0,t.jsx)(n.$,{variant:"outline",size:"sm",onClick:x,disabled:p,children:"重新识别"})]})}),(0,t.jsxs)(i.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[N.map((e,s)=>(0,t.jsx)("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded",children:A===s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.p,{value:w,onChange:e=>I(e.target.value),className:"flex-1",onKeyDown:e=>{"Enter"===e.key&&T(),"Escape"===e.key&&D()},autoFocus:!0}),(0,t.jsx)(n.$,{size:"sm",variant:"ghost",onClick:T,children:(0,t.jsx)(G.A,{className:"size-4"})}),(0,t.jsx)(n.$,{size:"sm",variant:"ghost",onClick:D,children:(0,t.jsx)(j.A,{className:"size-4"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"flex-1",children:e}),(0,t.jsx)(n.$,{size:"sm",variant:"ghost",onClick:()=>P(s),children:(0,t.jsx)(q.A,{className:"size-4"})}),(0,t.jsx)(n.$,{size:"sm",variant:"ghost",onClick:()=>S(s),children:(0,t.jsx)(g.A,{className:"size-4"})})]})},s)),0===N.length&&(0,t.jsx)("div",{className:"text-center py-4 text-gray-500",children:"暂无食材，请添加或重新识别"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(d.p,{placeholder:"手动添加食材...",value:b,onChange:e=>y(e.target.value),onKeyDown:e=>{"Enter"===e.key&&R()}}),(0,t.jsx)(n.$,{onClick:R,disabled:!b.trim(),children:(0,t.jsx)(u.A,{className:"size-4"})})]})]})]}),r.suggestions&&r.suggestions.length>0&&(0,t.jsxs)(i.Zp,{children:[(0,t.jsx)(i.aR,{className:"pb-3",children:(0,t.jsxs)(i.ZB,{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:"建议添加的食材"}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>_(!C),children:C?(0,t.jsx)(J.A,{className:"size-4"}):(0,t.jsx)(V.A,{className:"size-4"})})]})}),C&&(0,t.jsx)(i.Wu,{children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:r.suggestions.map((e,s)=>(0,t.jsxs)(o.E,{variant:"outline",className:"cursor-pointer hover:bg-primary hover:text-primary-foreground ".concat(N.includes(e)?"bg-primary text-primary-foreground":""),onClick:()=>Z(e),children:[e,!N.includes(e)&&(0,t.jsx)(u.A,{className:"size-3 ml-1"})]},s))})})]}),r.categories&&r.categories.length>0&&(0,t.jsxs)(i.Zp,{children:[(0,t.jsx)(i.aR,{className:"pb-3",children:(0,t.jsx)(i.ZB,{children:"食材分类"})}),(0,t.jsx)(i.Wu,{children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:r.categories.map((e,s)=>(0,t.jsx)(o.E,{variant:"secondary",children:e},s))})})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,t.jsxs)(n.$,{onClick:B,disabled:0===N.length||p,className:"flex-1",children:[(0,t.jsx)(E.A,{className:"size-4 mr-2"}),"确认使用这些食材 (",N.length,")"]}),(0,t.jsx)(n.$,{variant:"outline",onClick:m,disabled:p,children:"取消"})]}),(0,t.jsxs)(O,{children:[(0,t.jsx)(L.A,{className:"size-4"}),(0,t.jsxs)(W,{children:[(0,t.jsx)("strong",{children:"提示："}),"您可以编辑、删除或添加食材。点击编辑图标可以修改食材名称，点击垃圾桶图标可以删除。 建议的食材可以点击直接添加到列表中。确认后这些食材将自动填入菜谱生成表单。"]})]})]})}var Q=a(3904);a(1890);var Y=function(e){return e.API_KEY_MISSING="api_key_missing",e.API_QUOTA_EXCEEDED="api_quota_exceeded",e.API_TIMEOUT="api_timeout",e.API_NETWORK_ERROR="api_network_error",e.IMAGE_TOO_LARGE="image_too_large",e.IMAGE_INVALID_FORMAT="image_invalid_format",e.IMAGE_CORRUPTED="image_corrupted",e.PARSING_ERROR="parsing_error",e.UNKNOWN_ERROR="unknown_error",e}({});function H(e){return{ingredients:[],confidence:0,description:"无法自动识别，请手动添加食材",suggestions:["土豆","番茄","洋葱","鸡蛋","鸡肉","盐","糖"],categories:["蔬菜","肉类","调料"],source:"fallback"}}function ee(e){let{onIngredientsConfirmed:s,className:a=""}=e,[r,c]=(0,l.useState)("idle"),[d,o]=(0,l.useState)(null),[x,m]=(0,l.useState)(null),[u,g]=(0,l.useState)(null),[j,p]=(0,l.useState)(null),[f,N]=(0,l.useState)(0),[v,b]=(0,l.useState)(0),y=(0,l.useCallback)(async(e,s)=>{o({file:e,dataUrl:s}),g(null),c("recognizing"),N(0);try{let e=setInterval(()=>{N(s=>s>=90?(clearInterval(e),90):s+10)},200),a=(0,P.getStoredAPIKeys)(),t=await fetch("/api/recognize-ingredients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageDataUrl:s,apiKeys:{doubao:a.doubao?{key:a.doubao,endpointId:a.doubaoEndpointId}:void 0},options:{maxRetries:2,timeout:3e4}})});if(clearInterval(e),N(100),!t.ok){let e=await t.json();throw Error(e.error||"HTTP ".concat(t.status,": ").concat(t.statusText))}let l=await t.json();if(!l.success)throw Error(l.error||"识别失败");m(l.data),c("success"),setTimeout(()=>N(0),1e3)}catch(a){console.error("食材识别失败:",a);let e=function(e){let s=("string"==typeof e?e:e.message).toLowerCase();return s.includes("api")&&(s.includes("key")||s.includes("密钥"))?"api_key_missing":s.includes("quota")||s.includes("limit")||s.includes("配额")?"api_quota_exceeded":s.includes("timeout")||s.includes("超时")?"api_timeout":s.includes("network")||s.includes("fetch")||s.includes("网络")?"api_network_error":s.includes("too large")||s.includes("过大")?"image_too_large":s.includes("format")||s.includes("格式")?"image_invalid_format":s.includes("corrupted")||s.includes("损坏")?"image_corrupted":s.includes("parse")||s.includes("json")||s.includes("解析")?"parsing_error":"unknown_error"}(a instanceof Error?a:"识别失败"),s=function(e){switch(e){case"api_key_missing":return{title:"API密钥未配置",message:"豆包视觉API密钥未配置或无效",suggestions:["点击右上角设置图标配置豆包API密钥","确保API密钥和端点ID都已正确填写","检查API密钥是否有视觉识别权限"],canRetry:!1};case"api_quota_exceeded":return{title:"API配额已用完",message:"当前API密钥的使用配额已达到限制",suggestions:["等待配额重置（通常在下个计费周期）","升级API套餐以获得更多配额","尝试使用其他API密钥","暂时使用手动输入食材功能"],canRetry:!1};case"api_timeout":return{title:"识别超时",message:"AI识别服务响应超时",suggestions:["检查网络连接是否稳定","尝试压缩图片后重新上传","稍后重试","如果问题持续，请手动输入食材"],canRetry:!0};case"api_network_error":return{title:"网络连接失败",message:"无法连接到AI识别服务",suggestions:["检查网络连接","确认防火墙没有阻止请求","稍后重试","使用手动输入食材功能"],canRetry:!0};case"image_too_large":return{title:"图片过大",message:"上传的图片文件过大",suggestions:["选择小于5MB的图片","使用图片压缩工具减小文件大小","尝试截取图片的主要部分","使用手机拍摄时选择较低分辨率"],canRetry:!1};case"image_invalid_format":return{title:"图片格式不支持",message:"上传的文件格式不受支持",suggestions:["使用JPG、PNG或WebP格式的图片","确保文件没有损坏","尝试用其他软件重新保存图片","使用手机重新拍摄"],canRetry:!1};case"image_corrupted":return{title:"图片文件损坏",message:"无法读取图片文件",suggestions:["重新选择图片文件","确保图片文件完整","尝试用其他设备打开图片确认","重新拍摄或下载图片"],canRetry:!1};case"parsing_error":return{title:"识别结果解析失败",message:"AI返回的结果格式异常",suggestions:["重试识别","尝试使用更清晰的图片","确保图片中食材清晰可见","如果问题持续，请手动输入食材"],canRetry:!0};default:return{title:"识别失败",message:"发生未知错误",suggestions:["重试识别","检查网络连接","尝试使用其他图片","使用手动输入食材功能"],canRetry:!0}}}(e);g(a instanceof Error?a.message:"识别失败，请重试"),p(s),c("error"),N(0),(e===Y.API_KEY_MISSING||e===Y.API_QUOTA_EXCEEDED)&&H()}},[]),A=(0,l.useCallback)(()=>{o(null),m(null),g(null),p(null),c("idle"),N(0),b(0)},[]),k=(0,l.useCallback)(()=>{d&&(b(e=>e+1),g(null),p(null),y(d.file,d.dataUrl))},[d,y]),w=(0,l.useCallback)(e=>{s(e),c("confirmed"),setTimeout(()=>{let e=document.querySelector("[data-generate-button]");e&&!e.disabled&&e.click()},500)},[s]),z=(0,l.useCallback)(()=>{A()},[A]);return(0,t.jsxs)("div",{className:"space-y-6 ".concat(a),children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-2",children:[(0,t.jsx)(K.A,{className:"size-6 text-primary"}),(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"AI图片食材识别"})]}),(0,t.jsx)("p",{className:"text-gray-600",children:"上传食材图片，AI将自动识别其中的食材并生成菜谱"})]}),"idle"===r&&(0,t.jsx)(F,{onImageSelect:y,onImageRemove:A,isUploading:!1,maxSizeInMB:5,acceptedFormats:["image/jpeg","image/png","image/webp"]}),"recognizing"===r&&(0,t.jsx)(i.Zp,{children:(0,t.jsx)(i.Wu,{className:"p-6",children:(0,t.jsxs)("div",{className:"text-center space-y-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)($.A,{className:"size-12 text-primary animate-spin"}),(0,t.jsx)(h.A,{className:"size-6 text-yellow-500 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"AI正在识别食材..."}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"请稍候，这通常需要几秒钟时间"})]}),f>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"识别进度"}),(0,t.jsxs)("span",{children:[f,"%"]})]}),(0,t.jsx)(Z,{value:f,className:"h-2"})]}),(0,t.jsx)(n.$,{variant:"outline",onClick:z,disabled:f>50,children:"取消"})]})})}),"success"===r&&x&&(0,t.jsx)(X,{result:x,onConfirm:w,onRetry:k,onCancel:z,isLoading:!1}),"confirmed"===r&&x&&(0,t.jsx)(i.Zp,{className:"border-green-200 bg-green-50",children:(0,t.jsx)(i.Wu,{className:"p-6",children:(0,t.jsxs)("div",{className:"text-center space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2 text-green-700",children:[(0,t.jsx)(E.A,{className:"size-6"}),(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"食材已确认"})]}),(0,t.jsx)("p",{className:"text-green-600 text-sm",children:"已成功识别并添加食材到您的列表中，现在可以生成菜谱了！"}),(0,t.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,t.jsx)(n.$,{onClick:()=>{o(null),m(null),g(null),c("idle")},variant:"outline",size:"sm",children:"重新识别"}),(0,t.jsxs)(n.$,{onClick:()=>{let e=document.querySelector("[data-generate-button]");e&&!e.disabled?e.click():null==e||e.scrollIntoView({behavior:"smooth",block:"center"})},className:"bg-green-600 hover:bg-green-700",children:[(0,t.jsx)(h.A,{className:"size-4 mr-2"}),"立即生成菜谱"]})]})]})})}),"error"===r&&j&&(0,t.jsx)(i.Zp,{children:(0,t.jsx)(i.Wu,{className:"p-6",children:(0,t.jsxs)(O,{variant:"destructive",children:[(0,t.jsx)(L.A,{className:"size-4"}),(0,t.jsx)(W,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:j.title}),(0,t.jsx)("p",{className:"mt-1 text-sm",children:j.message}),v>0&&(0,t.jsxs)("p",{className:"mt-1 text-xs text-gray-600",children:["已重试 ",v," 次"]})]}),j.suggestions.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-sm mb-2",children:"解决建议："}),(0,t.jsx)("ul",{className:"text-sm space-y-1",children:j.suggestions.map((e,s)=>(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"text-xs mt-1",children:"•"}),(0,t.jsx)("span",{children:e})]},s))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[j.canRetry&&(0,t.jsxs)(n.$,{variant:"outline",size:"sm",onClick:k,disabled:!d||v>=3,children:[(0,t.jsx)(Q.A,{className:"size-4 mr-2"}),v>=3?"已达最大重试次数":"重试"]}),(0,t.jsx)(n.$,{variant:"outline",size:"sm",onClick:z,children:"重新选择图片"}),(0,t.jsx)(n.$,{variant:"secondary",size:"sm",onClick:()=>{H(),s([])},children:"手动输入食材"})]})]})})]})})}),(0,t.jsxs)(i.Zp,{className:"bg-blue-50 border-blue-200",children:[(0,t.jsx)(i.aR,{className:"pb-3",children:(0,t.jsxs)(i.ZB,{className:"text-blue-800 flex items-center gap-2",children:[(0,t.jsx)(h.A,{className:"size-5"}),"功能特点"]})}),(0,t.jsx)(i.Wu,{className:"text-blue-700",children:(0,t.jsxs)("ul",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)(E.A,{className:"size-4 text-blue-600"}),"支持JPG、PNG、WebP格式图片"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)(E.A,{className:"size-4 text-blue-600"}),"自动压缩优化，提升识别速度"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)(E.A,{className:"size-4 text-blue-600"}),"AI智能识别，支持多种食材"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)(E.A,{className:"size-4 text-blue-600"}),"可编辑结果，确保准确性"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)(E.A,{className:"size-4 text-blue-600"}),"一键生成菜谱，省时省力"]})]})})]})]})}var es=a(7550),ea=a(6874),et=a.n(ea);function el(){let[e,s]=(0,l.useState)([]),[a,d]=(0,l.useState)({dietaryRestrictions:[],cuisineType:[],cookingTime:30,servings:2,difficulty:"easy",allergies:[]}),[o,m]=(0,l.useState)(!1),[u,g]=(0,l.useState)(null),[j,p]=(0,l.useState)(null),[f,N]=(0,l.useState)(!1),[b,y]=(0,l.useState)(!1),[A,k]=(0,l.useState)(!1),w=(0,r.useRouter)();(0,l.useEffect)(()=>{k(!0);let e=()=>{y((0,P.hasAnyAPIKey)())};e();let s=setInterval(e,1e3);return()=>clearInterval(s)},[]);let z=async()=>{let s;if(0===e.length)return void g("请至少添加一种食材");if(!b)return void g("要生成个性化菜谱，需要配置AI服务。点击右上角按钮进行配置。");m(!0),g(null);try{let t=(0,P.hasAnyAPIKey)()?(0,P.getStoredAPIKeys)():void 0,l=(0,P.getPreferredRecipeProvider)(),r=new AbortController;s=setTimeout(()=>{r.signal.aborted||r.abort("Request timeout")},12e4);let i=await fetch("/api/generate-recipe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ingredients:e,preferences:a,preferredProvider:l,apiKeys:t?{deepseek:t.deepseek,doubao:t.doubao?{key:t.doubao,endpointId:t.doubaoEndpointId}:void 0,qwen:t.qwen,glm:t.glm,gemini:t.gemini}:void 0}),signal:r.signal});if(s&&clearTimeout(s),!i.ok){let e=await i.json();throw Error(e.error||"生成菜谱失败")}let n=await i.json();if(n.success&&n.data&&n.data.recipe)localStorage.setItem("currentRecipe",JSON.stringify(n.data.recipe)),localStorage.setItem("recipeIngredients",JSON.stringify(e)),localStorage.setItem("recipePreferences",JSON.stringify(a)),w.push("/recipe");else throw console.error("数据结构错误:",n),Error(n.error||"未收到有效的菜谱数据")}catch(s){console.error("生成菜谱失败:",s);let e="生成菜谱失败，请重试";s instanceof Error&&("AbortError"===s.name||s.message.includes("aborted")?e="请求超时，AI服务响应较慢，请稍后重试":s.message.includes("timeout")?e="请求超时，请检查网络连接后重试":(s.message.includes("API"),e=s.message)),g(e)}finally{s&&clearTimeout(s),m(!1)}},I=e.length>0&&!o;return A?(0,t.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-red-50",children:[(0,t.jsx)("header",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("nav",{className:"flex items-center justify-between",children:[(0,t.jsxs)(et(),{href:"/",className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[(0,t.jsx)(es.A,{className:"size-5"}),(0,t.jsx)(x.A,{className:"size-6 text-orange-500"}),(0,t.jsx)("span",{className:"text-xl font-bold",children:"RecipeGenius"})]}),(0,t.jsx)(T,{onOpenSettings:()=>N(!0)})]})}),(0,t.jsxs)("div",{className:"container mx-auto px-4 pb-8 max-w-4xl",children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl md:text-4xl font-bold mb-4 text-gray-900",children:"告诉我你有什么食材"}),(0,t.jsx)("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"拍照识别或手动输入你现有的食材，设置你的偏好，让AI为你创造美味菜谱"}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-4 text-sm text-gray-500",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(K.A,{className:"size-4 text-blue-500"}),(0,t.jsx)("span",{children:"AI图片识别"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"✏️"}),(0,t.jsx)("span",{children:"手动输入"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(h.A,{className:"size-4 text-orange-500"}),(0,t.jsx)("span",{children:"智能生成"})]})]})]}),(0,t.jsxs)(c.tU,{defaultValue:"image-recognition",className:"space-y-6",children:[(0,t.jsxs)(c.j7,{className:"grid w-full grid-cols-3 max-w-lg mx-auto",children:[(0,t.jsxs)(c.Xi,{value:"image-recognition",className:"flex items-center gap-2",children:[(0,t.jsx)(K.A,{className:"size-4"}),"图片识别"]}),(0,t.jsx)(c.Xi,{value:"ingredients",className:"flex items-center gap-2",children:"\uD83E\uDD55 手动输入"}),(0,t.jsx)(c.Xi,{value:"preferences",className:"flex items-center gap-2",children:"⚙️ 偏好设置"})]}),(0,t.jsx)(c.av,{value:"ingredients",children:(0,t.jsxs)(i.Zp,{children:[(0,t.jsxs)(i.aR,{children:[(0,t.jsx)(i.ZB,{className:"text-xl",children:"手动添加食材"}),(0,t.jsx)(i.BT,{children:"输入你现有的食材，我们会为你推荐最佳的搭配方案"})]}),(0,t.jsx)(i.Wu,{children:(0,t.jsx)(v,{onIngredientsChange:s,initialIngredients:e})})]})}),(0,t.jsx)(c.av,{value:"image-recognition",children:(0,t.jsx)(ee,{onIngredientsConfirmed:a=>{let t=[...e],l=0;a.forEach(e=>{!t.includes(e)&&(t.push(e),l++)}),s(t),g(null),p(l>0?"成功识别并添加了 ".concat(l,' 种食材！您可以在"手动输入"标签页查看和编辑。'):"识别完成！所有食材都已在列表中。"),setTimeout(()=>p(null),5e3)}})}),(0,t.jsx)(c.av,{value:"preferences",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(i.Zp,{children:(0,t.jsxs)(i.aR,{children:[(0,t.jsx)(i.ZB,{className:"text-xl",children:"个性化设置"}),(0,t.jsx)(i.BT,{children:"根据你的需求定制菜谱，让AI生成最适合你的方案"})]})}),(0,t.jsx)(_,{onPreferencesChange:d,initialPreferences:a})]})})]}),(0,t.jsxs)("div",{className:"mt-8 space-y-4",children:[j&&(0,t.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-green-700 text-sm",children:j})}),u&&(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,t.jsx)("p",{className:"text-red-700 text-sm",children:u}),u.includes("API密钥")&&(0,t.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>N(!0),className:"mt-2 text-red-700 border-red-300 hover:bg-red-50",children:[(0,t.jsx)(S.A,{className:"size-4 mr-2"}),"配置API密钥"]})]}),(0,t.jsx)(i.Zp,{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white border-0",children:(0,t.jsx)(i.Wu,{className:"p-6",children:(0,t.jsxs)("div",{className:"text-center space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-xl font-bold",children:"准备好了吗？"}),(0,t.jsx)("p",{className:"opacity-90",children:e.length>0?"已添加 ".concat(e.length," 种食材，点击生成专属菜谱"):"请先添加一些食材"})]}),(0,t.jsx)(n.$,{onClick:()=>{z()},disabled:!I,size:"lg",variant:"secondary",className:"text-lg px-8 py-4 font-semibold","data-generate-button":!0,children:o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($.A,{className:"mr-2 size-5 animate-spin"}),"AI正在创作中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.A,{className:"mr-2 size-5"}),"生成我的专属菜谱"]})}),e.length>0&&(0,t.jsx)("div",{className:"text-sm opacity-75",children:"预计生成时间：5-10秒"})]})})})]}),(0,t.jsxs)("div",{className:"mt-6 text-center space-y-2",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"\uD83D\uDCA1 小贴士：添加更多食材可以获得更丰富的菜谱选择"}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"\uD83D\uDCF8 支持拍照识别食材 | ✏️ 支持手动输入 | \uD83E\uDD16 AI智能推荐"})]})]}),(0,t.jsx)(R.$,{isOpen:f,onClose:()=>N(!1),onKeysUpdated:()=>{y((0,P.hasAnyAPIKey)()),g(null)}})]}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[352,65,964,622,941,441,684,358],()=>s(5261)),_N_E=e.O()}]);